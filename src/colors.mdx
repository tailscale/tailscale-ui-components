import React, { useEffect, useState } from "react";
import { Meta, ColorPalette, ColorItem } from "@storybook/addon-docs/blocks";

<Meta title="Colors" />

{(() => {
  const colorNames = [
    "gray", "blue", "green", "red", "yellow", "orange"
  ];
  const steps = [
    "0", "50", "100", "200", "300", "400", "500", "600", "700", "800", "900", "1000"
  ];

  function rgbStringToHex(rgbString) {
    const rgb = rgbString.split(" ").map(Number);
    if (rgb.length !== 3 || rgb.some(isNaN)) return rgbString;
    return (
      "#" +
      rgb
        .map((x) => x.toString(16).padStart(2, "0"))
        .join("")
        .toLowerCase()
    );
  }

  // getting the colors computed from the color CSS variables
  function resolveColors() {
    const style = getComputedStyle(document.documentElement);
    const resolved = {};

    colorNames.forEach((color) => {
      resolved[color] = {};
      steps.forEach((step) => {
        // Only add if the variable exists
        const varName = `--color-${color}-${step}`;
        const value = style.getPropertyValue(varName).trim();
        if (value) {
          resolved[color][step] = rgbStringToHex(value);
        }
      });
    });

    resolved.white = {
      white: rgbStringToHex(style.getPropertyValue("--color-white").trim())
    };

    return resolved;
  }

  const ResolvedColorPalette = () => {
    const [colors, setColors] = useState(null);

    useEffect(() => {
      setColors(resolveColors());
    }, []);

    if (!colors) return <div>Loading color paletteâ€¦</div>;

    return (
      <ColorPalette>
        {Object.entries(colors).map(([group, colorObj]) => (
          <ColorItem
            key={group}
            title={group.charAt(0).toUpperCase() + group.slice(1)}
            colors={colorObj}
          />
        ))}
      </ColorPalette>
    );
  };

  return <ResolvedColorPalette />;
})()}